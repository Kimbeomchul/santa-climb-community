<!doctype html>
<html xmlns:th="http://www.thymleaf.org">
<script type="text/javascript" src="/js/santaUtil.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.9.4/lottie.min.js"></script>
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<div th:replace="~{fragment/header :: linkHead}"></div>

<body style="height:100%; background: white;">
<!-- 로딩바 -->
<div class="wrapper" style="display: none;">
    <div id="myGIF"></div>
</div>
<!-- 로딩바 -->
    <div class="wrap">
        <section class="main mountain_search">
            <header class="header">
                <a href="https://santa-community.co.kr/main">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_2_882)">
                        <path d="M17.1699 24C17.0383 24.0007 16.9078 23.9755 16.786 23.9257C16.6641 23.876 16.5533 23.8027 16.4599 23.71L8.28988 15.54C7.82425 15.0755 7.45482 14.5238 7.20276 13.9163C6.95069 13.3089 6.82095 12.6577 6.82095 12C6.82095 11.3423 6.95069 10.6911 7.20276 10.0837C7.45482 9.4762 7.82425 8.92445 8.28988 8.45999L16.4599 0.290002C16.5531 0.196764 16.6638 0.122803 16.7856 0.0723425C16.9075 0.0218822 17.038 -0.00408935 17.1699 -0.00408936C17.3017 -0.00408936 17.4323 0.0218822 17.5541 0.0723425C17.676 0.122803 17.7866 0.196764 17.8799 0.290002C17.9731 0.38324 18.0471 0.49393 18.0975 0.615752C18.148 0.737574 18.174 0.868142 18.174 1C18.174 1.13186 18.148 1.26243 18.0975 1.38425C18.0471 1.50607 17.9731 1.61676 17.8799 1.71L9.70988 9.87999C9.14808 10.4425 8.83252 11.205 8.83252 12C8.83252 12.795 9.14808 13.5575 9.70988 14.12L17.8799 22.29C17.9736 22.3829 18.048 22.4935 18.0988 22.6154C18.1495 22.7373 18.1757 22.868 18.1757 23C18.1757 23.132 18.1495 23.2627 18.0988 23.3846C18.048 23.5064 17.9736 23.617 17.8799 23.71C17.7864 23.8027 17.6756 23.876 17.5538 23.9257C17.432 23.9755 17.3015 24.0007 17.1699 24Z" fill="#374957"/>
                        </g>
                        <defs>
                        <clipPath id="clip0_2_882">
                        <rect width="24" height="24" fill="white"/>
                        </clipPath>
                        </defs>
                    </svg>
                </a>
                <h2 th:if="${search == null or search == ''}" style="font-weight: bold">전체</h2>
                <h2 th:unless="${search == null or search == ''}" th:text="|${search} 검색결과|">전체</h2>
                <div class="search_icon">
                    <svg width="23" height="24" viewBox="0 0 23 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_2_373)">
                        <path d="M22.6761 22.2937L16.9666 16.3247C18.5225 14.3353 19.2875 11.7968 19.1033 9.23426C18.9191 6.67173 17.7999 4.28123 15.9771 2.55722C14.1544 0.833208 11.7675 -0.0924103 9.31023 -0.0281784C6.85298 0.0360534 4.51334 1.08522 2.77525 2.90231C1.03716 4.7194 0.0336128 7.16539 -0.0278264 9.73434C-0.0892655 12.3033 0.796108 14.7987 2.44516 16.7043C4.09421 18.6099 6.38078 19.78 8.8319 19.9725C11.283 20.1651 13.7111 19.3653 15.6141 17.7387L21.3235 23.7077C21.5039 23.8899 21.7456 23.9907 21.9964 23.9884C22.2471 23.9861 22.4871 23.8809 22.6644 23.6955C22.8417 23.5101 22.9423 23.2593 22.9445 22.9971C22.9467 22.7349 22.8503 22.4823 22.6761 22.2937ZM9.56501 18.0007C8.05155 18.0007 6.57208 17.5315 5.31369 16.6525C4.0553 15.7734 3.0745 14.524 2.49532 13.0622C1.91615 11.6004 1.76461 9.99182 2.05987 8.43998C2.35513 6.88813 3.08393 5.46266 4.15411 4.34384C5.22428 3.22502 6.58777 2.4631 8.07215 2.15442C9.55652 1.84573 11.0951 2.00416 12.4934 2.60966C13.8916 3.21516 15.0867 4.24054 15.9276 5.55614C16.7684 6.87173 17.2172 8.41845 17.2172 10.0007C17.2149 12.1217 16.408 14.1551 14.9734 15.6549C13.5388 17.1547 11.5938 17.9983 9.56501 18.0007Z" fill="#374957"/>
                        </g>
                        <defs>
                        <clipPath id="clip0_2_373">
                        <rect width="22.9565" height="24" fill="white"/>
                        </clipPath>
                        </defs>
                    </svg>
                    <input id="searchInput" class="search_valid" type="text">
                </div>
            </header>
            <div id="mt_list">
                <div th:each="mt : ${mt}" class="m_search" th:value="${mt.mntcode}">
                    <div class="m_search_box" th:value="${mt.mntcode}">
                        <div class="img_box">
                            <img th:if="${mt.mntimages == ''}" src="/img/default_mountain.png" alt="">
                            <img th:unless="${mt.mntimages == ''}" th:src="@{${mt.mntimages}}" src="/img/default_mountain.png" alt="">
                        </div>
                        <ul>
                            <li><h4 th:text="${mt.mntiname}">산이름</h4></li>
                            <li>
                                <ul>
                                    <li>
                                        <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <g clip-path="url(#clip0_2_388)">
                                            <rect width="13" height="13" fill="white"/>
                                            <g style="mix-blend-mode:multiply">
                                            <path d="M6.50004 3.25C6.07152 3.25 5.65261 3.37707 5.29631 3.61515C4.94 3.85323 4.66229 4.19161 4.4983 4.58752C4.33431 4.98343 4.29141 5.41907 4.37501 5.83936C4.45861 6.25965 4.66496 6.64572 4.96798 6.94873C5.27099 7.25175 5.65705 7.4581 6.07735 7.5417C6.49764 7.6253 6.93328 7.5824 7.32919 7.41841C7.7251 7.25442 8.06348 6.97671 8.30156 6.6204C8.53964 6.2641 8.66671 5.84519 8.66671 5.41667C8.66671 4.84203 8.43844 4.29093 8.03211 3.8846C7.62578 3.47827 7.07468 3.25 6.50004 3.25ZM6.50004 6.5C6.28578 6.5 6.07633 6.43646 5.89817 6.31743C5.72002 6.19839 5.58117 6.02919 5.49917 5.83124C5.41718 5.63329 5.39572 5.41547 5.43752 5.20532C5.47933 4.99517 5.5825 4.80214 5.73401 4.65063C5.88552 4.49913 6.07855 4.39595 6.28869 4.35415C6.49884 4.31235 6.71666 4.3338 6.91462 4.4158C7.11257 4.49779 7.28176 4.63665 7.4008 4.8148C7.51984 4.99295 7.58338 5.2024 7.58338 5.41667C7.58338 5.70398 7.46924 5.97953 7.26607 6.1827C7.06291 6.38586 6.78736 6.5 6.50004 6.5Z" fill="#17C99E"/>
                                            </g>
                                            <path d="M6.49996 13.0002C6.04384 13.0025 5.59381 12.8955 5.18753 12.6882C4.78126 12.4809 4.43057 12.1792 4.16483 11.8085C2.10054 8.96095 1.0535 6.82028 1.0535 5.44553C1.0535 4.00104 1.62732 2.61571 2.64873 1.5943C3.67014 0.572891 5.05546 -0.000930786 6.49996 -0.000930786C7.94445 -0.000930786 9.32977 0.572891 10.3512 1.5943C11.3726 2.61571 11.9464 4.00104 11.9464 5.44553C11.9464 6.82028 10.8994 8.96095 8.83508 11.8085C8.56934 12.1792 8.21865 12.4809 7.81238 12.6882C7.4061 12.8955 6.95607 13.0025 6.49996 13.0002ZM6.49996 1.18153C5.36918 1.18282 4.28509 1.63259 3.48551 2.43217C2.68593 3.23175 2.23616 4.31584 2.23487 5.44661C2.23487 6.53536 3.26025 8.54874 5.12141 11.1157C5.27942 11.3333 5.4867 11.5105 5.7263 11.6326C5.9659 11.7547 6.23102 11.8184 6.49996 11.8184C6.76889 11.8184 7.03401 11.7547 7.27361 11.6326C7.51321 11.5105 7.7205 11.3333 7.8785 11.1157C9.73966 8.54874 10.765 6.53536 10.765 5.44661C10.7637 4.31584 10.314 3.23175 9.5144 2.43217C8.71482 1.63259 7.63073 1.18282 6.49996 1.18153Z" fill="#17C99E"/>
                                            </g>
                                            <defs>
                                            <clipPath id="clip0_2_388">
                                            <rect width="13" height="13" fill="white"/>
                                            </clipPath>
                                            </defs>
                                        </svg>
                                        <p th:text="${mt.mntiadd}">제주도 제주시 해안동</p>
                                    </li>
                                    <li class="like_btn likes" th:value="${mt.mntcode}">
                                        <svg th:if="${mt.likesYsno} == 0" class="likes" width="16" height="15" viewBox="0 0 17 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path class="likes" th:classappend="|likes_btn${mt.mntcode}|" d="M2.0566 7.11262L2.05661 7.11262L2.0546 7.11064C1.72122 6.78167 1.45598 6.38861 1.27478 5.95431C1.09351 5.51986 1 5.05322 1 4.58182C1 4.11043 1.09351 3.64379 1.27478 3.20934C1.45595 2.77511 1.72112 2.38213 2.05441 2.05319C2.74065 1.37723 3.66073 0.999997 4.61759 0.999997C5.57417 0.999997 6.49416 1.37699 7.18027 2.05245C7.18064 2.05281 7.18101 2.05317 7.18138 2.05353L7.88092 2.74748C8.27288 3.1363 8.90578 3.13391 9.29479 2.74213L9.82256 2.21061C10.5084 1.53674 11.4273 1.16069 12.3827 1.16069C13.3398 1.16069 14.2602 1.53809 14.9465 2.21423C15.2795 2.54272 15.5445 2.93521 15.7256 3.36883C15.9066 3.80264 16 4.26876 16 4.73984C16 5.21091 15.9066 5.67704 15.7256 6.11084C15.5445 6.54459 15.2794 6.93717 14.9462 7.26572L14.9462 7.26571L14.9432 7.26862L8.58451 13.5905L2.0566 7.11262Z" fill="white" stroke="#17C99E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                        </svg>

                                        <svg th:unless="${mt.likesYsno} == 0" class="likes" width="16" height="15" viewBox="0 0 17 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path class="likes" th:classappend="|likes_btn${mt.mntcode}|" d="M2.0566 7.11262L2.05661 7.11262L2.0546 7.11064C1.72122 6.78167 1.45598 6.38861 1.27478 5.95431C1.09351 5.51986 1 5.05322 1 4.58182C1 4.11043 1.09351 3.64379 1.27478 3.20934C1.45595 2.77511 1.72112 2.38213 2.05441 2.05319C2.74065 1.37723 3.66073 0.999997 4.61759 0.999997C5.57417 0.999997 6.49416 1.37699 7.18027 2.05245C7.18064 2.05281 7.18101 2.05317 7.18138 2.05353L7.88092 2.74748C8.27288 3.1363 8.90578 3.13391 9.29479 2.74213L9.82256 2.21061C10.5084 1.53674 11.4273 1.16069 12.3827 1.16069C13.3398 1.16069 14.2602 1.53809 14.9465 2.21423C15.2795 2.54272 15.5445 2.93521 15.7256 3.36883C15.9066 3.80264 16 4.26876 16 4.73984C16 5.21091 15.9066 5.67704 15.7256 6.11084C15.5445 6.54459 15.2794 6.93717 14.9462 7.26572L14.9462 7.26571L14.9432 7.26862L8.58451 13.5905L2.0566 7.11262Z" fill="#17C99E" stroke="#17C99E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                        </svg>

                                        <p class="likes likes_text" th:classappend ="|like_${mt.mntcode}|" th:text="${mt.mntlikes}">1,000</p>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

        </section>

        <div class="plus_btn" style="bottom:10%;">
            <p>▲</p>
        </div>
    </div>
    <script th:inline="javascript">
        $(function(){
            let cho = /[ㄱ-ㅎ|ㅏ-ㅣ]/g;
            $(".plus_btn").hide();

            $(".search_icon > svg").click(function(){
                $(".search_icon > input").toggleClass('active');
                if($(".search_icon > input").hasClass('active') == false && $(".search_icon > input").val() != ''){
                    let val_input = $(".search_icon > input").val().trim();
                    if(cho.test(val_input)){
                        $(".search_icon > input").val("");
                        Print.postMessage('초성 검색은 불가능합니다');
                        return false;
                    }
                    if(val_input == "산"){
                        $(".search_icon > input").val("");
                        Print.postMessage('검색결과가 많습니다. 다른검색어로 검색해주세요');
                        return false;
                    }
                    if(val_input == "") return false;
                    location.href= "https://santa-community.co.kr/mt/search/"+val_input;
                }
            });

            $("#searchInput").on("keydown",function (e){
                if(e.key === "Enter"){
                    $(".search_icon > svg").click();
                }
            });

            // 상단으로 이동버튼
            $(document).on("click",".plus_btn",function(){
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth',
                });
            });


            // 쓰로틀링 타이머
            let timer;
            // 스크롤감지 함수
            $(window).scroll(function(){

                // 산검색으로 들어왔을시 스크롤무시 -- flag : search
                let searchedYsno = "[(${search})]";
                if(searchedYsno) return false;

                // 일정수준 내려갈시 상단이동 버튼생성
                if($(window).scrollTop() > 500){
                    $(".plus_btn").fadeIn(450);
                }
                // 일정수준 상단 도달시 버튼사라져어
                if($(window).scrollTop() < 200){
                    $(".plus_btn").fadeOut(450);
                }
                // 바닥감지 다음페이지 로딩
                if($(window).scrollTop() + $(window).height() + 100 >= $(document).height()){
                    // 개수가 적으면 무시
                    if($(".m_search").length < 30){
                        return;
                    }

                    // Throttle Scroll event
                    if(!timer){
                        timer = setTimeout(()=>{
                            timer = null;
                            let pagingStart = $(".m_search").length + 1;
                            $.ajax({
                                type: "GET",
                                url: "https://santa-community.co.kr/mt/list/" + pagingStart,
                                success : function(result){
                                    append_mt(result);
                                },
                                error : function(err){
                                    console.log(err);
                                }
                            });
                        }, 500);
                    }
                }
            });
        });

        $(document).on("click",".m_search_box",function(e){
            if ($(e.target).is('.likes')) {
                return;
            }
            location.href="https://santa-community.co.kr/mt/detail/" + $(this).attr("value");
        });

        function append_mt(obj){
            let str = "";
            for(let i=0; i<obj.length; i++){
                let objMyLikes = obj[i]['likesYsno'];
                console.log(objMyLikes);
                // 산 이미지
                str += "<div class='m_search' value='" +obj[i]['mntcode']+ "'><div class='m_search_box' value='"+obj[i]['mntcode']+"'>";
                str += ""+"<div class='img_box'><img src='/img/default_mountain.png' alt=''></div>"+"";
                // 산 이름
                str += "<ul><li><h4>"+obj[i]['mntiname']+"</h4></li>";
                str += "<li><ul><li><svg width='13' height='13' viewBox='0 0 13 13' fill='none' xmlns='http://www.w3.org/2000/svg'><g clip-path='url(#clip0_2_388)'>";
                str += "<rect width='13' height='13' fill='white'/><g style='mix-blend-mode:multiply'><path d='M6.50004 3.25C6.07152 3.25 5.65261 3.37707 5.29631 3.61515C4.94 3.85323 4.66229 4.19161 4.4983 4.58752C4.33431 4.98343 4.29141 5.41907 4.37501 5.83936C4.45861 6.25965 4.66496 6.64572 4.96798 6.94873C5.27099 7.25175 5.65705 7.4581 6.07735 7.5417C6.49764 7.6253 6.93328 7.5824 7.32919 7.41841C7.7251 7.25442 8.06348 6.97671 8.30156 6.6204C8.53964 6.2641 8.66671 5.84519 8.66671 5.41667C8.66671 4.84203 8.43844 4.29093 8.03211 3.8846C7.62578 3.47827 7.07468 3.25 6.50004 3.25ZM6.50004 6.5C6.28578 6.5 6.07633 6.43646 5.89817 6.31743C5.72002 6.19839 5.58117 6.02919 5.49917 5.83124C5.41718 5.63329 5.39572 5.41547 5.43752 5.20532C5.47933 4.99517 5.5825 4.80214 5.73401 4.65063C5.88552 4.49913 6.07855 4.39595 6.28869 4.35415C6.49884 4.31235 6.71666 4.3338 6.91462 4.4158C7.11257 4.49779 7.28176 4.63665 7.4008 4.8148C7.51984 4.99295 7.58338 5.2024 7.58338 5.41667C7.58338 5.70398 7.46924 5.97953 7.26607 6.1827C7.06291 6.38586 6.78736 6.5 6.50004 6.5Z' fill='#17C99E'/></g>";
                str += "<path d='M6.49996 13.0002C6.04384 13.0025 5.59381 12.8955 5.18753 12.6882C4.78126 12.4809 4.43057 12.1792 4.16483 11.8085C2.10054 8.96095 1.0535 6.82028 1.0535 5.44553C1.0535 4.00104 1.62732 2.61571 2.64873 1.5943C3.67014 0.572891 5.05546 -0.000930786 6.49996 -0.000930786C7.94445 -0.000930786 9.32977 0.572891 10.3512 1.5943C11.3726 2.61571 11.9464 4.00104 11.9464 5.44553C11.9464 6.82028 10.8994 8.96095 8.83508 11.8085C8.56934 12.1792 8.21865 12.4809 7.81238 12.6882C7.4061 12.8955 6.95607 13.0025 6.49996 13.0002ZM6.49996 1.18153C5.36918 1.18282 4.28509 1.63259 3.48551 2.43217C2.68593 3.23175 2.23616 4.31584 2.23487 5.44661C2.23487 6.53536 3.26025 8.54874 5.12141 11.1157C5.27942 11.3333 5.4867 11.5105 5.7263 11.6326C5.9659 11.7547 6.23102 11.8184 6.49996 11.8184C6.76889 11.8184 7.03401 11.7547 7.27361 11.6326C7.51321 11.5105 7.7205 11.3333 7.8785 11.1157C9.73966 8.54874 10.765 6.53536 10.765 5.44661C10.7637 4.31584 10.314 3.23175 9.5144 2.43217C8.71482 1.63259 7.63073 1.18282 6.49996 1.18153Z' fill='#17C99E'/></g><defs><clipPath id='clip0_2_388'><rect width='13' height='13' fill='white'/></clipPath></defs></svg>";
                // 산 주소
                str += "<p>"+obj[i]['mntiadd']+"</p>";
                str += "</li><li class='likes like_btn' value='"+obj[i]['mntcode']+"'><svg class='likes' width='16' height='15' viewBox='0 0 17 14' fill='none' xmlns='http://www.w3.org/2000/svg'>";
                if(objMyLikes == 0){
                    str += '<path class="likes likes_btn'+obj[i]['mntcode']+'" d="M2.0566 7.11262L2.05661 7.11262L2.0546 7.11064C1.72122 6.78167 1.45598 6.38861 1.27478 5.95431C1.09351 5.51986 1 5.05322 1 4.58182C1 4.11043 1.09351 3.64379 1.27478 3.20934C1.45595 2.77511 1.72112 2.38213 2.05441 2.05319C2.74065 1.37723 3.66073 0.999997 4.61759 0.999997C5.57417 0.999997 6.49416 1.37699 7.18027 2.05245C7.18064 2.05281 7.18101 2.05317 7.18138 2.05353L7.88092 2.74748C8.27288 3.1363 8.90578 3.13391 9.29479 2.74213L9.82256 2.21061C10.5084 1.53674 11.4273 1.16069 12.3827 1.16069C13.3398 1.16069 14.2602 1.53809 14.9465 2.21423C15.2795 2.54272 15.5445 2.93521 15.7256 3.36883C15.9066 3.80264 16 4.26876 16 4.73984C16 5.21091 15.9066 5.67704 15.7256 6.11084C15.5445 6.54459 15.2794 6.93717 14.9462 7.26572L14.9462 7.26571L14.9432 7.26862L8.58451 13.5905L2.0566 7.11262Z" fill="white" stroke="#17C99E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>';
                }else{
                    str += '<path class="likes likes_btn'+obj[i]['mntcode']+'" d="M2.0566 7.11262L2.05661 7.11262L2.0546 7.11064C1.72122 6.78167 1.45598 6.38861 1.27478 5.95431C1.09351 5.51986 1 5.05322 1 4.58182C1 4.11043 1.09351 3.64379 1.27478 3.20934C1.45595 2.77511 1.72112 2.38213 2.05441 2.05319C2.74065 1.37723 3.66073 0.999997 4.61759 0.999997C5.57417 0.999997 6.49416 1.37699 7.18027 2.05245C7.18064 2.05281 7.18101 2.05317 7.18138 2.05353L7.88092 2.74748C8.27288 3.1363 8.90578 3.13391 9.29479 2.74213L9.82256 2.21061C10.5084 1.53674 11.4273 1.16069 12.3827 1.16069C13.3398 1.16069 14.2602 1.53809 14.9465 2.21423C15.2795 2.54272 15.5445 2.93521 15.7256 3.36883C15.9066 3.80264 16 4.26876 16 4.73984C16 5.21091 15.9066 5.67704 15.7256 6.11084C15.5445 6.54459 15.2794 6.93717 14.9462 7.26572L14.9462 7.26571L14.9432 7.26862L8.58451 13.5905L2.0566 7.11262Z" fill="#17C99E" stroke="#17C99E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>';
                }
                str += "<p class='likes likes_text like_"+obj[i]['mntcode']+"'>"+obj[i]['mntlikes']+"</p>";
                str += "</li></ul></li></ul></div></div>";
            }
            document.getElementById("mt_list").innerHTML += str;
        }


        // 좋아요
        $(document).on("click",".like_btn",function(){
            let mntcode = $(this).attr("value");
            let thisMtLikes = $(".like_" + mntcode).text();
            $.ajax({
                type: "POST",
                url: "https://santa-community.co.kr/mt/like/" + mntcode,
                success : function(result){
                    console.log(result);
                    if(result == 2) { // 삽입일시
                        santaLikeAnimationStart("/json/likes.json", 0.9);
                        $(".likes_btn" + mntcode).attr("fill", "#17C99E");
                        $(".likes_btn" + mntcode).attr("stroke", "#17C99E");
                        $(".like_"+ mntcode).text(parseInt(thisMtLikes) + 1);
                    }else{ // 삭제일시
                        $(".likes_btn" + mntcode).attr("fill", "white");
                        $(".likes_btn" + mntcode).attr("stroke", "#17C99E");
                        $(".like_"+ mntcode).text(parseInt(thisMtLikes) - 1);
                    }
                },
                error : function(err){
                    console.log("좋아요 에러 = {}", err);
                }
            });
        });
    </script>

</body>
</html>
