<!doctype html>

<html xmlns:th="http://www.thymleaf.org">
<script type="text/javascript" src="/js/santaUtil.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.9.4/lottie.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.3/moment-with-locales.min.js"></script>
<div th:replace="~{fragment/header :: linkHead}"></div>
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<body>
<!-- 로딩바 -->
<div class="wrapper" style="display: none;">
    <div id="myGIF"></div>
</div>
<!-- 로딩바 -->
    <div class="wrap">
        <!-- Alert -->
        <div class="start_modal" id="climb_alert" style="display: none;">
            <div class="modal_box">
                <h3><span id="climb_mt_name" style="color: #17C99E; font-weight: bold;"></span> 등산을 시작하시겠습니까?</h3>
                <p>위치정보제공을 <span style="color:#17C99E">항상</span>으로 변경해주세요.</p>
                <div class="modal_bottom">
                    <p class="hide_alert">아니요</p>
                    <p class="start_climb">등산하기</p>
                </div>
            </div>
        </div>
        <!-- Alert -->

        <section class="main mountain_search1" id="main_search">
            <header class="header">
                <a href="https://santa-community.co.kr/mt/list">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_2_325)">
                        <path d="M17.1699 24C17.0383 24.0007 16.9078 23.9755 16.786 23.9257C16.6641 23.876 16.5533 23.8027 16.4599 23.71L8.28986 15.54C7.82423 15.0755 7.4548 14.5238 7.20274 13.9163C6.95067 13.3089 6.82092 12.6577 6.82092 12C6.82092 11.3423 6.95067 10.6911 7.20274 10.0837C7.4548 9.4762 7.82423 8.92445 8.28986 8.45999L16.4599 0.290002C16.5531 0.196764 16.6638 0.122803 16.7856 0.0723425C16.9074 0.0218822 17.038 -0.00408935 17.1699 -0.00408936C17.3017 -0.00408936 17.4323 0.0218822 17.5541 0.0723425C17.6759 0.122803 17.7866 0.196764 17.8799 0.290002C17.9731 0.38324 18.0471 0.49393 18.0975 0.615752C18.148 0.737574 18.174 0.868142 18.174 1C18.174 1.13186 18.148 1.26243 18.0975 1.38425C18.0471 1.50607 17.9731 1.61676 17.8799 1.71L9.70986 9.87999C9.14806 10.4425 8.8325 11.205 8.8325 12C8.8325 12.795 9.14806 13.5575 9.70986 14.12L17.8799 22.29C17.9736 22.3829 18.048 22.4935 18.0988 22.6154C18.1495 22.7373 18.1757 22.868 18.1757 23C18.1757 23.132 18.1495 23.2627 18.0988 23.3846C18.048 23.5064 17.9736 23.617 17.8799 23.71C17.7864 23.8027 17.6756 23.876 17.5538 23.9257C17.4319 23.9755 17.3015 24.0007 17.1699 24Z" fill="white"/>
                        </g>
                        <defs>
                        <clipPath id="clip0_2_325">
                        <rect width="24" height="24" fill="white"/>
                        </clipPath>
                        </defs>
                    </svg>
                </a>
            </header>

            <div class="m_search1_up" id="search_up">
                <span></span>
                <div class="up_title">
                    <h2 th:text="${mt.mntiname}">산타산</h2>
                    <div>
                        <svg th:if="${mt.likesYsno} == 0" width="17" height="15" viewBox="0 0 17 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path id="like_btn" d="M2.0566 7.11262L2.05661 7.11262L2.0546 7.11064C1.72122 6.78167 1.45598 6.38861 1.27478 5.95431C1.09351 5.51986 1 5.05322 1 4.58182C1 4.11043 1.09351 3.64379 1.27478 3.20934C1.45595 2.77511 1.72112 2.38213 2.05441 2.05319C2.74065 1.37723 3.66073 0.999997 4.61759 0.999997C5.57417 0.999997 6.49416 1.37699 7.18027 2.05245C7.18064 2.05281 7.18101 2.05317 7.18138 2.05353L7.88092 2.74748C8.27288 3.1363 8.90578 3.13391 9.29479 2.74213L9.82256 2.21061C10.5084 1.53674 11.4273 1.16069 12.3827 1.16069C13.3398 1.16069 14.2602 1.53809 14.9465 2.21423C15.2795 2.54272 15.5445 2.93521 15.7256 3.36883C15.9066 3.80264 16 4.26876 16 4.73984C16 5.21091 15.9066 5.67704 15.7256 6.11084C15.5445 6.54459 15.2794 6.93717 14.9462 7.26572L14.9462 7.26571L14.9432 7.26862L8.58451 13.5905L2.0566 7.11262Z" fill="white" stroke="#17C99E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <svg th:unless="${mt.likesYsno} == 0" width="17" height="15" viewBox="0 0 17 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path id="like_btn" d="M2.0566 7.11262L2.05661 7.11262L2.0546 7.11064C1.72122 6.78167 1.45598 6.38861 1.27478 5.95431C1.09351 5.51986 1 5.05322 1 4.58182C1 4.11043 1.09351 3.64379 1.27478 3.20934C1.45595 2.77511 1.72112 2.38213 2.05441 2.05319C2.74065 1.37723 3.66073 0.999997 4.61759 0.999997C5.57417 0.999997 6.49416 1.37699 7.18027 2.05245C7.18064 2.05281 7.18101 2.05317 7.18138 2.05353L7.88092 2.74748C8.27288 3.1363 8.90578 3.13391 9.29479 2.74213L9.82256 2.21061C10.5084 1.53674 11.4273 1.16069 12.3827 1.16069C13.3398 1.16069 14.2602 1.53809 14.9465 2.21423C15.2795 2.54272 15.5445 2.93521 15.7256 3.36883C15.9066 3.80264 16 4.26876 16 4.73984C16 5.21091 15.9066 5.67704 15.7256 6.11084C15.5445 6.54459 15.2794 6.93717 14.9462 7.26572L14.9462 7.26571L14.9432 7.26862L8.58451 13.5905L2.0566 7.11262Z" fill="#17C99E" stroke="#17C99E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <p id="likes_cnt" style="padding-bottom: 3px;" th:text="${mt.mntlikes}">0</p>
                    </div>
                </div>
                <ul>
                    <li>주소</li>
                    <li th:text="${mt.mntiadd}">산타도 산타시 산타동</li>
                </ul>
                <ul>
                    <li>전화번호</li>
                    <li th:text="${mt.mntiadminnum}">02-0000-0000</li>
                </ul>
                <ul>
                    <li>높이</li>
                    <li th:text="|${mt.mntihigh} m|">790m</li>
                </ul>
                <ul>
                    <li>상세설명</li>
                    <li th:if="${mt.mntidetails} == '( - )'" style="text-align:center;" class="detail_content">
                        산정보가 없습니다. <br> 빠른시일내로 추가하도록 하겠습니다!
                    </li>
                    <li th:unless="${mt.mntidetails} == '( - )'" class="detail_content" th:text="${mt.mntidetails}">
                        산정보가 없습니다. <br> 빠른시일내로 추가하도록 하겠습니다!
                    </li>
                </ul>
                <button id="start_climb">등산하기</button>
            </div>
        </section>

    </div>

    <script th:inline="javascript">
        $(function(){
            let mntcode = "[(${mt.mntcode})]";
            $(".detail_content").css("max-height","200px");
            $(".detail_content").css("overflow-y","scroll");

            let detailImage = "[(${mt.mntimages})]";
            // 이미지 사진조정
            if(detailImage){
                let mathHeight = (document.body.offsetHeight - document.getElementById("search_up").offsetHeight) + 30;
                document.getElementById("main_search").style.cssText = "background-size : 100% "+mathHeight + "px; background-image : url(" + detailImage + ")";
            }

            $(".hide_alert").on("click",function (){
                $("#climb_alert").fadeOut(200);
            });

            $("#start_climb").on("click",function (){
                // 산이름설정
                let mntiname = "[(${mt.mntiname})]";
                $("#climb_mt_name").text(mntiname);

                $("#climb_alert").fadeIn(200);
                $(".start_climb").click(function (){
                    localStorage.setItem("climb.time", moment());
                   location.replace("/map/climb?mntiname="+mntiname);
                });
            });

            $("#like_btn").on("click", function (){
                $.ajax({
                    type: "POST",
                    url: "https://santa-community.co.kr/mt/like/" + mntcode,
                    success : function(result){
                        if(result == 2) { // 삽입일시
                            santaLikeAnimationStart("/json/likes.json", 0.9);
                            $("#like_btn").attr("fill", "#17C99E");
                            $("#like_btn").attr("stroke", "#17C99E");
                            $("#likes_cnt").text(parseInt($("#likes_cnt").text()) + 1);
                        }else{ // 삭제일시
                            $("#like_btn").attr("fill", "white");
                            $("#like_btn").attr("stroke", "#17C99E");
                            $("#likes_cnt").text(parseInt($("#likes_cnt").text()) - 1);
                        }
                    },
                    error : function(err){
                        console.log("좋아요 에러 = {}", err);
                    }
                });
            });
        });
    </script>

</body>
</html>
